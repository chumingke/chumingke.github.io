<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Neucha:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="mysql," />





  <link rel="alternate" href="/atom.xml" title="chumingke-二师兄" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="转载自http://blog.csdn.net/goskalrie/article/details/53020631 触发器什么是触发器触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。该对象与编程语言中的函数非常类似，都需要声明、执行等。但是触发器的执行不是由程序调用，也不是由手工启动，而是由事件来触发、激活从而实现执行。有点类似DOM中的事件。 那么为什么要使用数">
<meta name="keywords" content="mysql">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL触发器与事件调度器">
<meta property="og:url" content="https://chumingke.github.io/blog/2017/10/MySQL-triggers-and-event-schedulers.html">
<meta property="og:site_name" content="chumingke-二师兄">
<meta property="og:description" content="转载自http://blog.csdn.net/goskalrie/article/details/53020631 触发器什么是触发器触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。该对象与编程语言中的函数非常类似，都需要声明、执行等。但是触发器的执行不是由程序调用，也不是由手工启动，而是由事件来触发、激活从而实现执行。有点类似DOM中的事件。 那么为什么要使用数">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-10-26T02:42:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL触发器与事件调度器">
<meta name="twitter:description" content="转载自http://blog.csdn.net/goskalrie/article/details/53020631 触发器什么是触发器触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。该对象与编程语言中的函数非常类似，都需要声明、执行等。但是触发器的执行不是由程序调用，也不是由手工启动，而是由事件来触发、激活从而实现执行。有点类似DOM中的事件。 那么为什么要使用数">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://chumingke.github.io/blog/2017/10/MySQL-triggers-and-event-schedulers.html"/>





  <title> MySQL触发器与事件调度器 | chumingke-二师兄 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">chumingke-二师兄</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <h1 class="site-subtitle" itemprop="description"></h1>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://chumingke.github.io/blog/2017/10/MySQL-triggers-and-event-schedulers.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="chumingke">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/dingxiu.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="chumingke-二师兄">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="chumingke-二师兄" src="/images/avatar.jpg">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                MySQL触发器与事件调度器
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-06T17:12:37+08:00">
                2017-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2017/10/MySQL-triggers-and-event-schedulers.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="/blog/2017/10/MySQL-triggers-and-event-schedulers.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          
 
        


        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>转载自<a href="http://blog.csdn.net/goskalrie/article/details/53020631" target="_blank" rel="external">http://blog.csdn.net/goskalrie/article/details/53020631</a></p>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><h2 id="什么是触发器"><a href="#什么是触发器" class="headerlink" title="什么是触发器"></a>什么是触发器</h2><p>触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。该对象与编程语言中的函数非常类似，都需要声明、执行等。但是触发器的执行不是由程序调用，也不是由手工启动，而是由事件来触发、激活从而实现执行。有点类似DOM中的事件。</p>
<p>那么为什么要使用数据库对象触发器呢？在具体开发项目时，经常会遇到如下实例：</p>
<p><1> 在学生表中拥有字段学生姓名，字段学生总数，每当添加一条学生信息时，学生的总数就必须同时更改。</1></p>
<p><2> 在学生表中还会有学生姓名的缩写，学生住址等字段，添加学生信息时，往往需要检查电话、邮箱等格式是否正确。<br>上面的例子使用触发器完成时具有这样的特点，需要在表发生改变时，自动进行一些处理。MySQL在触发DELETE/UPDATE/INSERT语句时就会自动执行所设置的操作，其他SQL语句则不会激活触发器。</2></p>
<h2 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h2><p>使用帮助命令查看具体的语法：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CREATE</div><div class="line">    [DEFINER = &#123;<span class="built_in"> user </span>| CURRENT_USER &#125;]</div><div class="line">    TRIGGER trigger_name</div><div class="line">    trigger_time trigger_event</div><div class="line">    ON tbl_name <span class="keyword">FOR</span> EACH ROW</div><div class="line">    trigger_body</div></pre></td></tr></table></figure></p>
<p>其中：<br>trigger_name：标识触发器名称，用户自行指定；<br>trigger_time：标识触发时机，取值为 BEFORE 或 AFTER；<br>trigger_event：标识触发事件，取值为 INSERT、UPDATE 或 DELETE；<br>tbl_name：标识建立触发器的表名，即在哪张表上建立触发器；<br>trigger_stmt：触发器程序体，可以是一句SQL语句，或者用 BEGIN 和 END 包含的多条语句。</p>
<p>由此可见，可以建立6种触发器，即：BEFORE INSERT、BEFORE UPDATE、BEFORE DELETE、AFTER INSERT、AFTER UPDATE、AFTER DELETE。</p>
<p>另外有一个限制是不能同时在一个表上建立2个相同类型的触发器，因此在一个表上最多建立6个触发器。</p>
<h3 id="trigger-event-详解"><a href="#trigger-event-详解" class="headerlink" title="trigger_event 详解"></a>trigger_event 详解</h3><p>MySQL 除了对 INSERT、UPDATE、DELETE 基本操作进行定义外，还定义了 LOAD DATA 和 REPLACE 语句，这两种语句也能引起上述6中类型的触发器的触发。</p>
<p>LOAD DATA 语句用于将一个文件装入到一个数据表中，相当与一系列的 INSERT 操作。</p>
<p>REPLACE 语句一般来说和 INSERT 语句很像，只是在表中有 primary key 或 unique 索引时，如果插入的数据和原来 primary key 或 unique 索引一致时，会先删除原来的数据，然后增加一条新数据，也就是说，一条 REPLACE 语句有时候等价于一条。</p>
<p>INSERT 语句，有时候等价于一条 DELETE 语句加上一条 INSERT 语句。</p>
<p>INSERT 型触发器：插入某一行时激活触发器，可能通过 INSERT、LOAD DATA、REPLACE 语句触发；<br>UPDATE 型触发器：更改某一行时激活触发器，可能通过 UPDATE 语句触发；<br>DELETE 型触发器：删除某一行时激活触发器，可能通过 DELETE、REPLACE 语句触发。</p>
<h3 id="BEGIN-…-END-详解"><a href="#BEGIN-…-END-详解" class="headerlink" title="BEGIN … END 详解"></a>BEGIN … END 详解</h3><p>在MySQL中，BEGIN … END 语句的语法为：<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">BEGIN</span></div><div class="line">[statement_list]</div><div class="line"><span class="keyword">END</span></div></pre></td></tr></table></figure></p>
<p>其中，statement_list 代表一个或多个语句的列表，列表内的每条语句都必须用分号（;）来结尾。<br>而在MySQL中，分号是语句结束的标识符，遇到分号表示该段语句已经结束，MySQL可以开始执行了。因此，解释器遇到statement_list 中的分号后就开始执行，然后会报出错误，因为没有找到和 BEGIN 匹配的 END。</p>
<p>这时就会用到 DELIMITER 命令（DELIMITER 是定界符，分隔符的意思），它是一条命令，不需要语句结束标识，语法为：<br>DELIMITER new_delemiter<br>new_delemiter 可以设为1个或多个长度的符号，默认的是分号（;），我们可以把它修改为其他符号，如$：<br>DELIMITER $<br>在这之后的语句，以分号结束，解释器不会有什么反应，只有遇到了$，才认为是语句结束。注意，使用完之后，我们还应该记得把它给修改回来。</p>
<h2 id="触发器示例一"><a href="#触发器示例一" class="headerlink" title="触发器示例一"></a>触发器示例一</h2><p>假设系统中有两个表：<br>班级表 class(班级号 classID, 班内学生数 stuCount)<br>学生表 student(学号 stuID, 所属班级号 classID)<br>要创建触发器来使班级表中的班内学生数随着学生的添加自动更新，代码如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">DELIMITER $</div><div class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_stuInsert <span class="keyword">after</span> <span class="keyword">insert</span></div><div class="line"><span class="keyword">on</span> student <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></div><div class="line"><span class="keyword">begin</span></div><div class="line"><span class="keyword">declare</span> c <span class="built_in">int</span>;</div><div class="line"><span class="keyword">set</span> c = (<span class="keyword">select</span> stuCount <span class="keyword">from</span> <span class="keyword">class</span> <span class="keyword">where</span> classID=new.classID);</div><div class="line"><span class="keyword">update</span> <span class="keyword">class</span> <span class="keyword">set</span> stuCount = c + <span class="number">1</span> <span class="keyword">where</span> classID = new.classID;</div><div class="line"><span class="keyword">end</span>$</div><div class="line">DELIMITER ;</div></pre></td></tr></table></figure></p>
<h3 id="变量详解"><a href="#变量详解" class="headerlink" title="变量详解"></a>变量详解</h3><p>MySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，</p>
<p>即其它语句之前，语法如下：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DECLARE var_name[,<span class="built_in">..</span>.]<span class="built_in"> type </span>[DEFAULT value]</div></pre></td></tr></table></figure></p>
<p>其中：<br>var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；变量初始值为 NULL，如果需要，可以使用 DEFAULT 子句提供默认值，值可以被指定为一个表达式。</p>
<p>对变量赋值采用 SET 语句，语法为：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="builtin-name">SET</span> var_name = expr [,var_name = expr] <span class="built_in">..</span>.</div></pre></td></tr></table></figure></p>
<h3 id="NEW-与-OLD-详解"><a href="#NEW-与-OLD-详解" class="headerlink" title="NEW 与 OLD 详解"></a>NEW 与 OLD 详解</h3><p>上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示</p>
<p>触发器的所在表中，触发了触发器的那一行数据。<br>具体地：<br>在 INSERT 型触发器中，NEW 用来表示将要（BEFORE）或已经（AFTER）插入的新数据；<br>在 UPDATE 型触发器中，OLD 用来表示将要或已经被修改的原数据，NEW 用来表示将要或已经修改为的新数据；<br>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；<br>使用方法： NEW.columnName （columnName 为相应数据表某一列名）<br>另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。</p>
<h3 id="查看触发器"><a href="#查看触发器" class="headerlink" title="查看触发器"></a>查看触发器</h3><p>和查看数据库（show databases;）查看表格（show tables;）一样，查看触发器的语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SHOW</span> <span class="keyword">TRIGGERS</span> [<span class="keyword">FROM</span> schema_name];</div></pre></td></tr></table></figure></p>
<p>其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就</p>
<p>不必先“USE database_name;”了。</p>
<h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h3><p>和删除数据库、删除表格一样，删除触发器的语法如下：<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] [schema_name.]trigger_name</div></pre></td></tr></table></figure></p>
<h3 id="触发器的执行顺序"><a href="#触发器的执行顺序" class="headerlink" title="触发器的执行顺序"></a>触发器的执行顺序</h3><p>我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：</p>
<p>①如果 BEFORE 触发器执行失败，SQL 无法正确执行。<br>②SQL 执行失败时，AFTER 型触发器不会触发。<br>③AFTER 类型的触发器执行失败，SQL 会回滚。</p>
<h2 id="触发器示例二"><a href="#触发器示例二" class="headerlink" title="触发器示例二"></a>触发器示例二</h2><p><1> 准备学生表和学生数目统计表<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">CREATE TABLE student_info (</div><div class="line">  stu_no INT(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">  stu_name VARCHAR(255)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</div><div class="line">  PRIMARY KEY (stu_no)</div><div class="line">);</div><div class="line">CREATE TABLE student_count (</div><div class="line">  student_count INT(11)<span class="built_in"> DEFAULT </span>0</div><div class="line">);</div><div class="line">INSERT INTO student_count VALUES(0);</div></pre></td></tr></table></figure></1></p>
<p><2> 创建简单触发器，在向学生表INSERT数据时，学生数增加，DELETE学生时，学生数减少<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_student_count_insert</div><div class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span></div><div class="line"><span class="keyword">ON</span> student_info <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></div><div class="line"><span class="keyword">UPDATE</span> student_count <span class="keyword">SET</span> student_count=student_count+<span class="number">1</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_student_count_delete</div><div class="line"><span class="keyword">AFTER</span> <span class="keyword">DELETE</span></div><div class="line"><span class="keyword">ON</span> student_info <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></div><div class="line"><span class="keyword">UPDATE</span> student_count <span class="keyword">SET</span> student_count=student_count<span class="number">-1</span>;</div></pre></td></tr></table></figure></2></p>
<p><3> INSERT、DELETE数据，查看触发器是否正常工作<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">mysql&gt; INSERT INTO student<span class="emphasis">_info VALUES(NULL,'张明'),(NULL,'李明'),(NULL,'王明');</span></div><div class="line"><span class="emphasis">Query OK, 3 rows affected (0.02 sec)</span></div><div class="line"><span class="emphasis">Records: 3  Duplicates: 0  Warnings: 0</span></div><div class="line"><span class="emphasis"> </span></div><div class="line"><span class="emphasis">mysql&gt; SELECT * FROM student_</span>info;</div><div class="line"><span class="code">+--------+</span>----------+</div><div class="line">| stu<span class="emphasis">_no | stu_</span>name |</div><div class="line"><span class="code">+--------+</span>----------+</div><div class="line">|      1 | 张明     |</div><div class="line">|      2 | 李明     |</div><div class="line">|      3 | 王明     |</div><div class="line"><span class="code">+--------+</span>----------+</div><div class="line">3 rows in set (0.00 sec)</div><div class="line"><span class="code"> </span></div><div class="line">mysql&gt; SELECT * FROM student<span class="emphasis">_count;</span></div><div class="line"><span class="emphasis">+---------------+</span></div><div class="line"><span class="emphasis">| student_</span>count |</div><div class="line"><span class="code">+---------------+</span></div><div class="line">|             3 |</div><div class="line"><span class="code">+---------------+</span></div><div class="line">1 row in set (0.00 sec)</div><div class="line"><span class="code"> </span></div><div class="line">mysql&gt; DELETE FROM student<span class="emphasis">_info WHERE stu_</span>name IN(<span class="emphasis">'张明'</span>,<span class="emphasis">'李明'</span>);</div><div class="line">Query OK, 2 rows affected (0.00 sec)</div><div class="line"><span class="code"> </span></div><div class="line">mysql&gt; SELECT * FROM student<span class="emphasis">_info;</span></div><div class="line"><span class="emphasis">+--------+----------+</span></div><div class="line"><span class="emphasis">| stu_</span>no | stu<span class="emphasis">_name |</span></div><div class="line"><span class="emphasis">+--------+----------+</span></div><div class="line"><span class="emphasis">|      3 | 王明     |</span></div><div class="line"><span class="emphasis">+--------+----------+</span></div><div class="line"><span class="emphasis">1 row in set (0.00 sec)</span></div><div class="line"><span class="emphasis"> </span></div><div class="line"><span class="emphasis">mysql&gt; SELECT * FROM student_</span>count;</div><div class="line"><span class="code">+---------------+</span></div><div class="line">| student<span class="emphasis">_count |</span></div><div class="line"><span class="emphasis">+---------------+</span></div><div class="line"><span class="emphasis">|             1 |</span></div><div class="line"><span class="emphasis">+---------------+</span></div><div class="line"><span class="emphasis">1 row in set (0.00 sec)</span></div></pre></td></tr></table></figure></3></p>
<p>可以看到无论是INSERT还是DELETE学生，学生数目都是跟随着变化的。</p>
<h2 id="创建包含多条执行语句的触发器"><a href="#创建包含多条执行语句的触发器" class="headerlink" title="创建包含多条执行语句的触发器"></a>创建包含多条执行语句的触发器</h2><p>在trigger_body中可以执行多条SQL语句，此时的trigger_body需要使用BEGIN和END作为开始和结束的标志：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CREATE</div><div class="line">    [DEFINER = &#123;<span class="built_in"> user </span>| CURRENT_USER &#125;]</div><div class="line">    TRIGGER trigger_name</div><div class="line">    trigger_time trigger_event</div><div class="line">ON tbl_name <span class="keyword">FOR</span> EACH ROW</div><div class="line">BEGIN</div><div class="line">trigger_statement</div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>依然沿用上面的例子中的表，对student_count表做如下变更：增加student_class字段表示具体年级的学生数，其中0表示全年级，1代表1年级……；同样学生表中也增加该字段。清空两个表中的所有数据。</p>
<p><1> 删除上例中的两个触发器，初始化student_count表中数据，插入三条数据(0,0),(1,0),(2,0)表示全年级、一年级、二年级的初始人数都是0；</1></p>
<p><2> 创建触发器，在INSERT时首先增加学生总人数，然后判断新增的学生是几年级的，再增加对应年级的学生总数：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">DELIMITER $$</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_student_count_insert</div><div class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span></div><div class="line"><span class="keyword">ON</span> student_info <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="keyword">UPDATE</span> student_count <span class="keyword">SET</span> student_count=student_count+<span class="number">1</span> <span class="keyword">WHERE</span> student_class=<span class="number">0</span>;</div><div class="line"><span class="keyword">UPDATE</span> student_count <span class="keyword">SET</span> student_count=student_count+<span class="number">1</span> <span class="keyword">WHERE</span> student_class= NEW.student_class;</div><div class="line"><span class="keyword">END</span></div><div class="line">$$</div><div class="line">DELIMITER ;</div></pre></td></tr></table></figure></2></p>
<p><3> 创建触发器，在DELETE时首先减少学生总人数，然后判断删除的学生是几年级的，再减少对应年级的学生总数：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">DELIMITER $$</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_student_count_delete</div><div class="line"><span class="keyword">AFTER</span> <span class="keyword">DELETE</span></div><div class="line"><span class="keyword">ON</span> student_info <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="keyword">UPDATE</span> student_count <span class="keyword">SET</span> student_count=student_count<span class="number">-1</span> <span class="keyword">WHERE</span> student_class=<span class="number">0</span>;</div><div class="line"><span class="keyword">UPDATE</span> student_count <span class="keyword">SET</span> student_count=student_count<span class="number">-1</span> <span class="keyword">WHERE</span> student_class= OLD.student_class;</div><div class="line"><span class="keyword">END</span></div><div class="line">$$</div><div class="line">DELIMITER ;</div></pre></td></tr></table></figure></3></p>
<p><4> 向学生表中分别插入多条不同年级的学生信息，查看触发器是否起作用：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">mysql&gt; INSERT INTO student<span class="emphasis">_info VALUES(NULL,'AAA',1),(NULL,'BBB',1),(NULL,'CCC',2),(NULL,'DDD',2),(NULL,'ABB',1),(NULL,'ACC',1);</span></div><div class="line"><span class="emphasis">Query OK, 6 rows affected (0.02 sec)</span></div><div class="line"><span class="emphasis">Records: 6  Duplicates: 0  Warnings: 0</span></div><div class="line"><span class="emphasis"> </span></div><div class="line"><span class="emphasis">mysql&gt; SELECT * FROM student_</span>info;</div><div class="line"><span class="code">+--------+</span>----------<span class="code">+---------------+</span></div><div class="line">| stu<span class="emphasis">_no | stu_</span>name | student<span class="emphasis">_class |</span></div><div class="line"><span class="emphasis">+--------+----------+---------------+</span></div><div class="line"><span class="emphasis">|      4 | AAA      |             1 |</span></div><div class="line"><span class="emphasis">|      5 | BBB      |             1 |</span></div><div class="line"><span class="emphasis">|      6 | CCC      |             2 |</span></div><div class="line"><span class="emphasis">|      7 | DDD      |             2 |</span></div><div class="line"><span class="emphasis">|      8 | ABB      |             1 |</span></div><div class="line"><span class="emphasis">|      9 | ACC      |             1 |</span></div><div class="line"><span class="emphasis">+--------+----------+---------------+</span></div><div class="line"><span class="emphasis">6 rows in set (0.00 sec)</span></div><div class="line"><span class="emphasis"> </span></div><div class="line"><span class="emphasis">mysql&gt; SELECT * FROM student_</span>count;</div><div class="line"><span class="code">+---------------+</span>---------------+</div><div class="line">| student<span class="emphasis">_count | student_</span>class |</div><div class="line"><span class="code">+---------------+</span>---------------+</div><div class="line">|             6 |             0 |</div><div class="line">|             4 |             1 |</div><div class="line">|             2 |             2 |</div><div class="line"><span class="code">+---------------+</span>---------------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure></4></p>
<p>可以看到，总共插入了6条数据，学生总数是6，1年级4个，2年级2个，trigger正确执行。</p>
<p><5> 从学生表中分别删除多条不同年级的学生信息，查看触发器是否起作用：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">mysql&gt; DELETE FROM student<span class="emphasis">_info WHERE stu_</span>name LIKE <span class="emphasis">'A%'</span>;</div><div class="line">Query OK, 3 rows affected (0.02 sec)</div><div class="line"><span class="code"> </span></div><div class="line">mysql&gt; SELECT * FROM student<span class="emphasis">_info;</span></div><div class="line"><span class="emphasis">+--------+----------+---------------+</span></div><div class="line"><span class="emphasis">| stu_</span>no | stu<span class="emphasis">_name | student_</span>class |</div><div class="line"><span class="code">+--------+</span>----------<span class="code">+---------------+</span></div><div class="line">|      5 | BBB      |             1 |</div><div class="line">|      6 | CCC      |             2 |</div><div class="line">|      7 | DDD      |             2 |</div><div class="line"><span class="code">+--------+</span>----------<span class="code">+---------------+</span></div><div class="line">3 rows in set (0.00 sec)</div><div class="line"><span class="code"> </span></div><div class="line">mysql&gt; SELECT * FROM student<span class="emphasis">_count;</span></div><div class="line"><span class="emphasis">+---------------+---------------+</span></div><div class="line"><span class="emphasis">| student_</span>count | student<span class="emphasis">_class |</span></div><div class="line"><span class="emphasis">+---------------+---------------+</span></div><div class="line"><span class="emphasis">|             3 |             0 |</span></div><div class="line"><span class="emphasis">|             1 |             1 |</span></div><div class="line"><span class="emphasis">|             2 |             2 |</span></div><div class="line"><span class="emphasis">+---------------+---------------+</span></div><div class="line"><span class="emphasis">3 rows in set (0.00 sec)</span></div></pre></td></tr></table></figure></5></p>
<p>从学生表中将姓名以A开头的学生信息删除，学生信息删除的同时，数量表也跟随变化。<br>在上面的示例中，使用了三个新的关键字：DELIMITER、NEW、OLD，这三个关键字在官网上“触发器语法”一节中都有介绍，整理如下：</p>
<h4 id="DELIMITER"><a href="#DELIMITER" class="headerlink" title="DELIMITER"></a>DELIMITER</h4><p>使用BEGIN…END结构，可以定义一个执行多句SQL的触发器。在BEGIN语句块中，还可以使用其它的语法，例如条件语句和循环语句。在MySQL中，分号”;”标志着SQL语句的结束，但是在触发器要执行的SQL语句中使用到了”;”作为要执行SQL语句的结束标记，所以你需要重新定义结束标识符。<br>重新定义结束标识符使用DELIMITER关键字，后面跟空格和重新定义的结束标识符。<br>注意：该语句与其他语句不同的是不需要在语句末尾添加结束标志符，如DELIMITER<br>的作用是将现有的结束标识符重新定义为<br>，但是，此时由于习惯或是疏忽在末尾添加了”;”也就是” DELIMITER<br>;”那么该语句的作用就变成了将符号”<br>;”作为新的结束标志符。</p>
<h4 id="NEW和OLD"><a href="#NEW和OLD" class="headerlink" title="NEW和OLD"></a>NEW和OLD</h4><p>NEW在触发器为INSERT事件类型时有效，表示当前正在插入的数据；同理，OLD在触发器类型为DELETE事件类型时有效，表示当前正在删除的数据。<br>如上面的示例中，可以在触发器中使用NEW.student_class取得正在插入的学生信息中年级值，使用OLD.student_class取得正在删除的学生信息中的年级值。</p>
<h2 id="视频课程案例"><a href="#视频课程案例" class="headerlink" title="视频课程案例"></a>视频课程案例</h2><p>在同一个位置不能建立两个不同的触发器,可以合并</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">##例子1</div><div class="line"><span class="keyword">create</span> <span class="keyword">TRIGGER</span> tr_1</div><div class="line">after <span class="keyword">insert</span> <span class="keyword">on</span> card_money</div><div class="line"><span class="keyword">for</span> <span class="keyword">each</span> row</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">case</span> <span class="keyword">when</span> c.<span class="built_in">type</span>=<span class="number">1</span>    ##状态码</div><div class="line">    <span class="keyword">then</span></div><div class="line">    <span class="keyword">update</span> card_info <span class="keyword">set</span> money =money+new.c <span class="keyword">where</span> id=new.cid;</div><div class="line">    else</div><div class="line">    <span class="keyword">update</span> card_info <span class="keyword">set</span> money =money-new.c <span class="keyword">where</span> id=new.cid;</div><div class="line">end;</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card_money <span class="keyword">values</span> (<span class="number">2</span>,<span class="number">1</span>,<span class="number">0.1</span>,<span class="number">1</span>);</div><div class="line"></div><div class="line">例子2:</div><div class="line"><span class="keyword">create</span> <span class="keyword">TRIGGER</span> tr_2</div><div class="line">after <span class="keyword">update</span> <span class="keyword">on</span> card_money</div><div class="line"><span class="keyword">for</span> <span class="keyword">each</span> row</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">update</span> card_info <span class="keyword">set</span> money =money-old.c+new.c <span class="keyword">where</span> id=new.cid;</div><div class="line">end;</div></pre></td></tr></table></figure>
<h2 id="触发器的使用限制"><a href="#触发器的使用限制" class="headerlink" title="触发器的使用限制"></a>触发器的使用限制</h2><p>官网“触发器语法和示例” <a href="http://dev.mysql.com/doc/refman/5.6/en/trigger-syntax.html" target="_blank" rel="external">http://dev.mysql.com/doc/refman/5.6/en/trigger-syntax.html</a></p>
<p><1> 触发器只能创建在永久表上，不能对临时表创建触发器；</1></p>
<p><2> 触发器不能使用CALL语句调用具有返回值或使用了动态SQL的存储过程（存储过程可以使用OUT或INOUT参数返回给触发器返回值）。</2></p>
<p><3> 触发器中不能使用开启或结束事务的语句段，比如，开始事务（START TRANSACTION）、提交事务（COMMIT）或是回滚事务（ROLLBACK），但是回滚到一个保存点（SAVEPOINT是允许的，因为回滚到保存点不会结束事务）；</3></p>
<p><4> 外键不会激活触发器；</4></p>
<p><5> 当使用基于行的复制时，从表上的触发器不会因操作主表中的数据而激活。当使用基于语句的复制时，从表上的触发器会被激活。参考 Section 17.4.1.34,“Replication and Triggers”；</5></p>
<p><6> 触发器中不允许返回值，因此触发器中不能有返回语句，如果要立即停止一个触发器，应该使用LEAVE语句；</6></p>
<h2 id="触发器中的异常机制"><a href="#触发器中的异常机制" class="headerlink" title="触发器中的异常机制"></a>触发器中的异常机制</h2><p>MySQL的触发器是按照BEFORE触发器、行操作、AFTER触发器的顺序执行的，其中任何一步发生错误都不会继续执行剩下的操作。如果是对事务表进行的操作，那么会整个作为一个事务被回滚，但是如果是对非事务表进行的操作，那么已经更新的记录将无法回滚，这也是设计触发器的时候需要注意的问题。</p>
<h2 id="查看触发器-1"><a href="#查看触发器-1" class="headerlink" title="查看触发器"></a>查看触发器</h2><p>可以通过执行SHOW TRIGGERS命令查看触发器，但是因为不能查询指定的触发器，所以每次都返回所有的触发器的信息，使用不方便。但是可以使用查询系统表information_schema.triggers的方式指定查询条件，查看指定的触发器信息。如：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> USE information_schema;</span></div><div class="line">Database changed</div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> SELECT  * FROM triggers WHERE trigger_name=<span class="string">'trigger_student_count_insert'</span>;</span></div></pre></td></tr></table></figure></p>
<h1 id="事件调度器"><a href="#事件调度器" class="headerlink" title="事件调度器"></a>事件调度器</h1>
      
    </div>

    <div>
      
        

      
    </div>
  
        <div class="post-tags">
          
            <a href="/tags/mysql/" rel="tag"># mysql</a>
          
        </div>
      


    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>🐶 您的支持将鼓励我继续创作 🐶</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赞赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat-reward-img.jpg" alt="chumingke WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay-reward-img.jpg" alt="chumingke Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
         
      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2017/10/MySQL-database-tips.html" rel="next" title="MySQL数据库小技巧（注意点）">
                <i class="fa fa-chevron-left"></i> MySQL数据库小技巧（注意点）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2017/10/MySQL-query-exercises-50.html" rel="prev" title="MySQL查询语句练习题(50题版)">
                MySQL查询语句练习题(50题版) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="/blog/2017/10/MySQL-triggers-and-event-schedulers.html"
     data-title="MySQL触发器与事件调度器"
     data-content=""
     data-url="https://chumingke.github.io/blog/2017/10/MySQL-triggers-and-event-schedulers.html">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>

          
          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="monthly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="/blog/2017/10/MySQL-triggers-and-event-schedulers.html"
           data-title="MySQL触发器与事件调度器" data-url="https://chumingke.github.io/blog/2017/10/MySQL-triggers-and-event-schedulers.html">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/dingxiu.jpg"
               alt="chumingke" />
          <p class="site-author-name" itemprop="name">chumingke</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/chumingke" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/bi-ma-wen-34" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-battery-3"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.woaitqs.cc/" title="Qisen Tang" target="_blank">Qisen Tang</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://szhshp.org" title="szhshp的博客" target="_blank">szhshp的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://python.zhangwei.website" title="JuniorCoder" target="_blank">JuniorCoder</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://hippo-jessy.com" title="Hippo" target="_blank">Hippo</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.zhihu.com/people/lippi-ouyang" title="友链出租" target="_blank">友链出租</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#触发器"><span class="nav-number">1.</span> <span class="nav-text">触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是触发器"><span class="nav-number">1.1.</span> <span class="nav-text">什么是触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建触发器"><span class="nav-number">1.2.</span> <span class="nav-text">创建触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#trigger-event-详解"><span class="nav-number">1.2.1.</span> <span class="nav-text">trigger_event 详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BEGIN-…-END-详解"><span class="nav-number">1.2.2.</span> <span class="nav-text">BEGIN … END 详解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器示例一"><span class="nav-number">1.3.</span> <span class="nav-text">触发器示例一</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#变量详解"><span class="nav-number">1.3.1.</span> <span class="nav-text">变量详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NEW-与-OLD-详解"><span class="nav-number">1.3.2.</span> <span class="nav-text">NEW 与 OLD 详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看触发器"><span class="nav-number">1.3.3.</span> <span class="nav-text">查看触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除触发器"><span class="nav-number">1.3.4.</span> <span class="nav-text">删除触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#触发器的执行顺序"><span class="nav-number">1.3.5.</span> <span class="nav-text">触发器的执行顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器示例二"><span class="nav-number">1.4.</span> <span class="nav-text">触发器示例二</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建包含多条执行语句的触发器"><span class="nav-number">1.5.</span> <span class="nav-text">创建包含多条执行语句的触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DELIMITER"><span class="nav-number">1.5.0.1.</span> <span class="nav-text">DELIMITER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NEW和OLD"><span class="nav-number">1.5.0.2.</span> <span class="nav-text">NEW和OLD</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视频课程案例"><span class="nav-number">1.6.</span> <span class="nav-text">视频课程案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器的使用限制"><span class="nav-number">1.7.</span> <span class="nav-text">触发器的使用限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器中的异常机制"><span class="nav-number">1.8.</span> <span class="nav-text">触发器中的异常机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看触发器-1"><span class="nav-number">1.9.</span> <span class="nav-text">查看触发器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#事件调度器"><span class="nav-number">2.</span> <span class="nav-text">事件调度器</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chumingke</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>





        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ezlippi"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="//cdn.jsdelivr.net/ua-parser.js/0.7.10/ua-parser.min.js"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  












  
  

  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
